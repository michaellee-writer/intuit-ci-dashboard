<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intuit CI Newsletter Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #0077C5 0%, #004D80 100%);
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .header-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.9rem;
            opacity: 0.85;
        }
        
        .content {
            padding: 30px 0;
        }
        
        /* Filters Section */
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .filters-section h3 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #0077C5;
            padding-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #0077C5;
            box-shadow: 0 0 0 3px rgba(0,119,197,0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #0077C5 0%, #004D80 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,119,197,0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            box-shadow: 0 4px 12px rgba(108,117,125,0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        
        .btn-success:hover {
            box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #333;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #0077C5;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.85rem;
        }
        
        /* Action Bar */
        .action-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .selection-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.95rem;
        }
        
        .selection-count {
            font-weight: 700;
            color: #0077C5;
            font-size: 1.1rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* Articles Container */
        .articles-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .articles-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
        }
        
        .articles-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }
        
        /* Grid View */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .article-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .article-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .article-card.selected {
            border-color: #0077C5;
            background: rgba(0,119,197,0.03);
        }
        
        .article-card.featured {
            border-color: #ffc107;
            box-shadow: 0 0 0 2px rgba(255,193,7,0.3);
        }
        
        .article-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 10px;
        }
        
        .article-title {
            font-size: 1.05rem;
            font-weight: 600;
            color: #333;
            line-height: 1.4;
            flex: 1;
        }
        
        .article-title a {
            color: inherit;
            text-decoration: none;
        }
        
        .article-title a:hover {
            color: #0077C5;
        }
        
        .article-source {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .article-description {
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 12px;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .article-labels {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        
        .label {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .label-tier-first {
            background: #fff3cd;
            color: #856404;
        }
        
        .label-tier-second {
            background: #e9ecef;
            color: #495057;
        }
        
        .label-category {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .label-subsection {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .article-checkbox {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 20px;
            height: 20px;
            accent-color: #0077C5;
            cursor: pointer;
        }
        
        .article-star {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            opacity: 0.3;
            transition: opacity 0.2s, transform 0.2s;
        }
        
        .article-star:hover {
            opacity: 0.7;
            transform: scale(1.1);
        }
        
        .article-star.active {
            opacity: 1;
        }
        
        /* List View */
        .articles-list {
            padding: 10px 20px;
        }
        
        .article-list-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            transition: background 0.2s;
            align-items: flex-start;
        }
        
        .article-list-item:last-child {
            border-bottom: none;
        }
        
        .article-list-item:hover {
            background: #f8f9fa;
        }
        
        .article-list-item.selected {
            background: rgba(0,119,197,0.05);
        }
        
        .article-list-checkbox {
            margin-top: 4px;
            width: 18px;
            height: 18px;
            accent-color: #0077C5;
        }
        
        .article-list-main {
            flex: 1;
            min-width: 0;
        }
        
        .article-list-sidebar {
            min-width: 180px;
            text-align: right;
        }
        
        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            width: 95%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #0077C5 0%, #004D80 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }
        
        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.5rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }
        
        .modal-footer {
            padding: 15px 25px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: #fafafa;
        }
        
        /* Newsletter Preview */
        .newsletter-preview-frame {
            width: 100%;
            height: 550px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 1001;
            font-size: 0.95rem;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .empty-state p {
            font-size: 1.1rem;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #0077C5;
            color: white;
            border-color: #0077C5;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination span {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .articles-grid {
                grid-template-columns: 1fr;
            }
            
            .action-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-buttons {
                justify-content: center;
            }
            
            .article-list-item {
                flex-direction: column;
            }
            
            .article-list-sidebar {
                text-align: left;
            }
        }

        /* Search highlight */
        .search-highlight {
            background: #fff59d;
            padding: 1px 2px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <!-- Article Data - Updated by Writer Agent -->
    <script id="article-data" type="application/json">
{
  "metadata": {
    "lastUpdated": "2026-01-28T00:00:00Z",
    "totalArticles": 20,
    "dateRange": {
      "start": "2026-01-21",
      "end": "2026-01-28"
    },
    "issueNumber": 206
  },
  "articles": [
    {
      "id": "bf74b97b-e838-40d2-aef7-5e1fd112e4f8",
      "title": "TEST ARTICLE",
      "source": "TEST SOURCE",
      "url": "https://www.accountingtoday.com/opinion/help-clients-get-organized-for-a-less-stressful-tax-season",
      "description": "TEST HTML URL STAYS THE SAME",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-22",
      "publishedDate": "2026-01-22",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "TESTING",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "0e12c4d1-88c6-4a96-88da-dbe8e312d638",
      "title": "Irony alert: Hallucinated citations found in papers from NeurIPS, the prestigious AI conference",
      "source": "TechCrunch",
      "url": "https://techcrunch.com/2026/01/21/irony-alert-hallucinated-citations-found-in-papers-from-neurips-the-prestigious-ai-conference/",
      "description": "AI detection startup GPTZero scanned all 4,841 papers accepted by the prestigious Conference on Neural Information Processing Systems (NeurIPS), which took place last month in San Diego. The company f...",
      "category": "Business Platform - Small Business",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Accounting",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts pricing in the industry. Direct competitors Even, Sage are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "27e3de39-b308-47e2-9696-1f18d2f45120",
      "title": "OpenAI's former sales leader joins VC firm Acrew: OpenAI taught her where startups can build a 'moat'",
      "source": "TechCrunch",
      "url": "https://techcrunch.com/2026/01/21/openais-former-sales-leader-joins-vc-firm-acrew-openai-taught-her-where-startups-can-build-a-moat/",
      "description": "OpenAI's first sales leader, Aliisa Rosenthal, has found a new career: venture capital. She's joining Acrew Capital as a general partner, working alongside founding partner Lauren Kolodny and the firm...",
      "category": "Big Bet 3 - Mid-Market",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing in the industry. Direct competitors Even, Chase are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "bdeb564e-9d37-4e8f-b389-4285c414d916",
      "title": "YouTube will soon let creators make Shorts with their own AI likeness",
      "source": "TechCrunch",
      "url": "https://techcrunch.com/2026/01/21/youtube-will-soon-let-creators-make-shorts-with-their-own-ai-likeness/",
      "description": "YouTube Shorts viewers might soon see AI versions of their favorite creators when scrolling through their feeds. YouTube CEO Neal Mohan announced on Wednesday that creators will soon be able to make S...",
      "category": "AI Corner",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, pricing, product_expectations, distribution in the industry. Direct competitors Even are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "335276a1-b96c-4a62-971a-86da18fb0c23",
      "title": "OnePay and Klarna Let Consumers Convert Purchases Into Payment Plans",
      "source": "PYMNTS",
      "url": "https://www.pymnts.com/news/payment-methods/2026/onepay-and-klarna-let-consumers-convert-purchases-into-payment-plans/",
      "description": "OnePay and Klarna Let Consumers Convert Purchases Into Payment Plans By PYMNTS | January 21, 2026 | OnePay and Klarna have partnered to enable the users of the OnePay Cash financial services platform ...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing in the industry. Direct competitors Chase, Klarna are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Partnership"
      ]
    },
    {
      "id": "27d900cd-d02a-47b8-b60f-d3acc956d47f",
      "title": "OpenAI and Anthropic Compete for Enterprise Clients",
      "source": "PYMNTS",
      "url": "https://www.pymnts.com/news/artificial-intelligence/2026/openai-anthropic-compete-enterprise-clients/",
      "description": "OpenAI and Anthropic Compete for Enterprise Clients By PYMNTS | January 21, 2026 | Artificial intelligence startups OpenAI and Anthropic will be competing for enterprise clients this year, CNBC report...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Payments",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing, product_expectations, distribution in the industry. Direct competitors Citi are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "8454ff71-ae6e-4113-9c1d-8e2cc12fc080",
      "title": "The AML Playbook for CFOs Eyeing a Cross-Border Payment Upgrade",
      "source": "PYMNTS",
      "url": "https://www.pymnts.com/news/cross-border-commerce/cross-border-payments/2026/aml-playbook-chief-financial-officers-eyeing-cross-border-payment-upgrade/",
      "description": "The AML Playbook for CFOs Eyeing a Cross-Border Payment Upgrade By PYMNTS | January 21, 2026 | Highlights Cross-border payments increasingly drive growth and compliance, shaping market expansion while...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Payments",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing, product_expectations, distribution in the industry. Direct competitors Even, Citi, FIS are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "7c734de2-d959-477b-b6b6-2d61f875902f",
      "title": "China's investment crash raises credit risks for homebuilders, banks, government: Fitch",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/21/chinas-investment-crash-credit-default-risks-real-estate-banks-fitch.html",
      "description": "China's sharp investment downturn is amplifying credit risks across the economy, particularly homebuilders, real estate, banks and construction sectors, Fitch Ratings has warned, as a slowing economy ...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing in the industry. Direct competitors Even, Citi, FIS are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "e81cd1a9-d686-4334-9f0c-99e32b598df5",
      "title": "Bankers wary of nonbank payment rivals in 2026",
      "source": "American Banker",
      "url": "https://www.americanbanker.com/payments/news/exclusive-research-nonbank-competitors-are-plaguing-bankers",
      "description": "Payments Exclusive research Bankers wary of nonbank payment rivals in 2026 By Frank Gargano CloseText About Frank twitter frankgargano1 mailto frank.gargano@arizent.com linkedin fgargano January 21, 2...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing, product_expectations, distribution in the industry. Direct competitors Even, Citi, PayPal are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "9fb88521-be79-4353-95e9-1be69a0e0927",
      "title": "IRS shakes up leadership ahead of tax season",
      "source": "Accounting Today",
      "url": "https://www.accountingtoday.com/news/irs-shakes-up-leadership-ahead-of-tax-season",
      "description": "Tax AT Think IRS shakes up leadership ahead of tax season By Michael Cohn CloseText About Michael twitter mikecohnat mailto michael.cohn@arizent.com linkedin micohn January 21, 2026, 11:51 a.m. EST 5 Min Read ...",
      "category": "Big Bet 3 - Mid-Market",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing, distribution in the industry. Direct competitors Even, Deputy are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "bf74b97b-e838-40d2-aef7-5e1fd112e4f9",
      "title": "Help clients get better organized for a less stressful tax season",
      "source": "Accounting Today",
      "url": "https://www.accountingtoday.com/opinion/help-clients-get-organized-for-a-less-stressful-tax-season",
      "description": "Tax AT Think Help clients get better organized for a less stressful tax season By Nick Pasquarosa January 21, 2026, 10:00 a.m. EST 7 Min Read Facebook Twitter LinkedIn Email Research shows that three ...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing, product_expectations, distribution in the industry. Direct competitors Even, Vend, Sage are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "6172ce8e-f312-4411-9533-729255129bc0",
      "title": "Europe weighs using trade 'bazooka' against the U.S. as Greenland crisis deepens",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/19/europe-retaliatory-tariffs-aci-greenland-trump-threat-us.html",
      "description": "European states are reportedly considering retaliatory tariffs and broader punitive economic counter-measures against the U.S. after President Donald Trump threatened fresh export levies, deepening a ...",
      "category": "AI Corner",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-19",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing in the industry. Direct competitors Deputy are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "6b5f5d7f-6932-40a3-9138-b30cb02a51d0",
      "title": "What the U.S.-Taiwan deal means for the island's 'silicon shield'",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/19/us-taiwan-chip-deal-silicon-shield-tsmc-trump-tapei-ai-semiconductor-supply-chain.html",
      "description": "The U.S.-Taiwan deal aimed at expanding chip production capacity in the U.S. is unlikely to fully wean Washington off the island's most advanced semiconductors anytime soon, several analysts told CNBC...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-19",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing, distribution in the industry. Direct competitors Even are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Partnership"
      ]
    },
    {
      "id": "2149e5bf-2e5b-49ef-98aa-eecf8547d62d",
      "title": "Trump tells Hassett he wants to keep him where he is; Warsh Fed chair odds jump",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/16/warsh-sprints-ahead-in-fed-chair-race-following-trump-comments-on-hassett-prediction-markets-show.html",
      "description": "President Donald Trump on Friday said he'd prefer to keep National Economic Council Director Kevin Hassett in his position as top economic advisor, a statement that could change the dynamic in the rac...",
      "category": "Economic Indicators",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-16",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing in the industry."
    },
    {
      "id": "b88ae09a-40bf-4f8f-bc6f-ddce074afa36",
      "title": "Wholesale inflation was softer than expected, retail sales moved higher in November",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/14/wholesale-inflation-was-softer-than-expected-retail-sales-moved-higher-in-november.html",
      "description": "Wholesale prices moved up less than expected while consumers kept up a heavy buying pace in November, according to economic data released Wednesday. Theproducer price index, a measure of final demand ...",
      "category": "Business Platform - Small Business",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-14",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Commerce/Marketing/CRM",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing in the industry."
    },
    {
      "id": "a91cc097-e8c6-49d0-a25e-a0d47c065496",
      "title": "Global central bankers unite in defense of Fed Chair Jerome Powell",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/13/jerome-powell-defended-european-central-bankers.html",
      "description": "Global central bankers issued a statement Tuesday defending U.S. Federal Reserve ChairJerome Powellfollowing the launch of acriminal investigationinto the central bank chief. \"We stand in full solidar...",
      "category": "Business Platform - Small Business",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-13",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Accounting",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing in the industry. Direct competitors Even, Citi, Wave are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "6d56d546-2ffc-465e-b935-ff9dd1907b31",
      "title": "Supreme Court holds off on Trump tariff ruling for now \u2014 what's at stake for economy",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/08/the-supreme-court-may-rule-friday-on-trumps-tariffs-heres-whats-at-stake-for-the-economy.html",
      "description": "TheSupreme Courtdid not rule Friday on the legality of broadtariffsimposed by PresidentDonald Trump, leaving markets still awaiting a decision poised to have far-reaching impacts ontradepolicy and the...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-09",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Payments",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing, product_expectations in the industry. Direct competitors Even, FIS, Block are involved, indicating market shifts Intuit should monitor.",
      "labels": [
        "Funding",
        "Startup"
      ]
    },
    {
      "id": "b9dc36ae-4b59-4111-ac40-cd07db266260",
      "title": "Treasury Secretary Bessent says more Fed rate cuts are 'only ingredient missing' for stronger economy",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/08/treasury-secretary-bessent-says-more-fed-rate-cuts-are-only-ingredient-missing-for-stronger-economy.html",
      "description": "Treasury Secretary Scott Bessent on Thursday pressed the administration's desire for lower interest rates, saying they are the key to future economic growth. In a speech he will deliver before the Eco...",
      "category": "Business Platform - Small Business",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-08",
      "significanceTier": "First-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Accounting",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing in the industry. Direct competitors Even, Sage are involved, indicating market shifts Intuit should monitor."
    },
    {
      "id": "e56f82cb-b409-4206-98bd-d0df8da6ec30",
      "title": "China says trade deal with U.S. will 'drain Taiwan's economy' for American benefits",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/21/china-us-taiwan-deal-semiconductors-chips-supply-chain-trade-deal.html",
      "description": "China has doubled down on its criticism of the trade deal between Taiwan and the U.S. agreed last week, warning that it would benefit Washington while eroding the island's industrial strength. The tra...",
      "category": "Big Bet 2 - Money",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-21",
      "significanceTier": "Second-Tier",
      "selected": false,
      "featured": false,
      "subsection": "Consumers",
      "relevanceScore": 100,
      "companyRelevance": "This development impacts regulation, pricing in the industry."
    },
    {
      "id": "d5ae8c6a-c5c0-4212-acb3-711a88424c67",
      "title": "UK economy surprises with stronger-than-expected 0.3% growth in November",
      "source": "CNBC",
      "url": "https://www.cnbc.com/2026/01/15/uk-gdp-november-2025-data.html",
      "description": "The U.K. economy grew by a more-than-expected 0.3% in November, data from the Office for National Statistics (ONS) showed Thursday. Economists polled by Reuters had expected a very modest growth figur...",
      "category": "Economic Indicators",
      "collectedDate": "2026-01-21",
      "publishedDate": "2026-01-15",
      "significanceTier": "Second-Tier",
      "selected": false,
      "featured": false,
      "relevanceScore": 100,
      "companyRelevance": "This development impacts customer_behavior, regulation, pricing in the industry."
    }
  ]
}
    </script>

    <!-- Header -->
    <header class="header">
        <h1>üì∞ Intuit CI Newsletter Dashboard</h1>
        <p>Select and organize articles for your weekly newsletter</p>
        <div class="header-meta">
            <span id="last-updated">Last updated: --</span>
            <span id="issue-number">Issue #--</span>
            <span id="date-range">Date range: --</span>
        </div>
    </header>

    <div class="container">
        <div class="content">
            <!-- Filters Section -->
            <div class="filters-section">
                <h3>üîç Filters & Search</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="searchInput">Search Articles</label>
                        <input type="text" id="searchInput" placeholder="Search title or description...">
                    </div>
                    
                    <div class="filter-group">
                        <label for="categoryFilter">Category</label>
                        <select id="categoryFilter">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="tierFilter">Significance Tier</label>
                        <select id="tierFilter">
                            <option value="">All Tiers</option>
                            <option value="First-Tier">First-Tier</option>
                            <option value="Second-Tier">Second-Tier</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="labelFilter">Label</label>
                        <select id="labelFilter">
                            <option value="">All Labels</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="dateFrom">From Date</label>
                        <input type="date" id="dateFrom">
                    </div>
                    
                    <div class="filter-group">
                        <label for="dateTo">To Date</label>
                        <input type="date" id="dateTo">
                    </div>
                    
                    <div class="filter-group">
                        <label for="sortBy">Sort By</label>
                        <select id="sortBy">
                            <option value="tier">Significance Tier</option>
                            <option value="date">Date (Newest)</option>
                            <option value="title">Title (A-Z)</option>
                            <option value="category">Category</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn" onclick="applyFilters()">üîç Apply Filters</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">üóëÔ∏è Clear Filters</button>
                    <button class="btn btn-secondary" onclick="toggleView()" id="viewToggleBtn">üìã List View</button>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">Total Articles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="firstTierCount">0</div>
                    <div class="stat-label">First-Tier</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="selectedCount">0</div>
                    <div class="stat-label">Selected</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="featuredCount">0</div>
                    <div class="stat-label">Featured ‚≠ê</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="visibleCount">0</div>
                    <div class="stat-label">Showing</div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <div class="selection-info">
                    <span><span class="selection-count" id="selectionDisplay">0</span> articles selected</span>
                    <span>(<span id="featuredDisplay">0</span> featured)</span>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="selectAllVisible()">‚òëÔ∏è Select All Visible</button>
                    <button class="btn btn-secondary" onclick="clearSelection()">‚úñÔ∏è Clear Selection</button>
                    <button class="btn btn-primary" id="refreshBtn" onclick="refreshData()">
                        üîÑ Refresh Data
                    </button>
                    <button class="btn btn-success" id="generateBtn" onclick="generateNewsletter()" disabled>
                        ‚ú® Generate Newsletter
                    </button>
                </div>
            </div>

            <!-- Articles Container -->
            <div class="articles-container">
                <div class="articles-header">
                    <h2>üìÑ Articles</h2>
                </div>
                <div id="articlesContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>No articles loaded. Writer Agent will update this dashboard with article data.</p>
                    </div>
                </div>
                <div class="pagination" id="pagination" style="display: none;">
                    <button onclick="changePage(-1)" id="prevBtn">‚Üê Previous</button>
                    <span id="pageInfo">Page 1 of 1</span>
                    <button onclick="changePage(1)" id="nextBtn">Next ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal-overlay" id="previewModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üì∞ Newsletter Preview</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <iframe id="previewFrame" class="newsletter-preview-frame"></iframe>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn btn-secondary" onclick="copyHTML()">üìã Copy HTML</button>
                <button class="btn btn-secondary" onclick="downloadHTML()">‚¨áÔ∏è Download HTML</button>
                <button class="btn" onclick="downloadPDF()">üìÑ Print / Save PDF</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ============================================
        // STATE
        // ============================================
        let articles = [];
        let filteredArticles = [];
        let metadata = {};
        let generatedHTML = '';
        let currentView = 'grid'; // 'grid' or 'list'
        let currentPage = 1;
        const articlesPerPage = 20;

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            loadArticleData();
            setupEventListeners();
        });

        function loadArticleData() {
            try {
                const dataScript = document.getElementById('article-data');
                const data = JSON.parse(dataScript.textContent);
                
                metadata = data.metadata;
                articles = data.articles.map((a, i) => ({
                    ...a,
                    _index: i,
                    selected: a.selected || false,
                    featured: a.featured || false
                }));

                filteredArticles = [...articles];
                
                updateHeaderMeta();
                populateFilterOptions();
                applyFilters();
                updateStats();
            } catch (e) {
                console.error('Failed to load article data:', e);
                showToast('Error loading article data', 'error');
            }
        }

        function updateHeaderMeta() {
            if (metadata.lastUpdated) {
                const date = new Date(metadata.lastUpdated);
                document.getElementById('last-updated').textContent = 
                    `Last updated: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
            }
            
            if (metadata.issueNumber) {
                document.getElementById('issue-number').textContent = `Issue #${metadata.issueNumber}`;
            }
            
            if (metadata.dateRange && metadata.dateRange.start) {
                const start = new Date(metadata.dateRange.start).toLocaleDateString();
                const end = metadata.dateRange.end ? new Date(metadata.dateRange.end).toLocaleDateString() : 'Now';
                document.getElementById('date-range').textContent = `Date range: ${start} - ${end}`;
            }
        }

        function setupEventListeners() {
            // Real-time search
            document.getElementById('searchInput').addEventListener('input', debounce(applyFilters, 300));
            
            // Filter changes
            ['categoryFilter', 'tierFilter', 'labelFilter', 'dateFrom', 'dateTo', 'sortBy'].forEach(id => {
                document.getElementById(id).addEventListener('change', applyFilters);
            });
        }

        // ============================================
        // FILTERS
        // ============================================
        function populateFilterOptions() {
            // Categories
            const categories = [...new Set(articles.map(a => a.category))].filter(Boolean).sort();
            const categorySelect = document.getElementById('categoryFilter');
            categorySelect.innerHTML = '<option value="">All Categories</option>' +
                categories.map(c => `<option value="${c}">${c}</option>`).join('');

            // Labels
            const labels = [...new Set(articles.flatMap(a => a.labels || []))].filter(Boolean).sort();
            const labelSelect = document.getElementById('labelFilter');
            labelSelect.innerHTML = '<option value="">All Labels</option>' +
                labels.map(l => `<option value="${l}">${l}</option>`).join('');

            // Set date range defaults
            if (metadata.dateRange) {
                if (metadata.dateRange.start) {
                    document.getElementById('dateFrom').value = metadata.dateRange.start.split('T')[0];
                }
                if (metadata.dateRange.end) {
                    document.getElementById('dateTo').value = metadata.dateRange.end.split('T')[0];
                }
            }
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const tier = document.getElementById('tierFilter').value;
            const label = document.getElementById('labelFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const sortBy = document.getElementById('sortBy').value;

            filteredArticles = articles.filter(article => {
                // Search
                if (search) {
                    const searchable = `${article.title} ${article.description} ${article.source}`.toLowerCase();
                    if (!searchable.includes(search)) return false;
                }

                // Category
                if (category && article.category !== category) return false;

                // Tier
                if (tier && article.significanceTier !== tier) return false;

                // Label
                if (label && !(article.labels || []).includes(label)) return false;

                // Date range
                const articleDate = article.publishedDate || article.collectedDate;
                if (dateFrom && articleDate && articleDate < dateFrom) return false;
                if (dateTo && articleDate && articleDate > dateTo + 'T23:59:59') return false;

                return true;
            });

            // Sort
            filteredArticles.sort((a, b) => {
                switch (sortBy) {
                    case 'tier':
                        const tierOrder = { 'First-Tier': 0, 'Second-Tier': 1 };
                        const tierDiff = (tierOrder[a.significanceTier] || 2) - (tierOrder[b.significanceTier] || 2);
                        if (tierDiff !== 0) return tierDiff;
                        return new Date(b.publishedDate || b.collectedDate || 0) - new Date(a.publishedDate || a.collectedDate || 0);
                    case 'date':
                        return new Date(b.publishedDate || b.collectedDate || 0) - new Date(a.publishedDate || a.collectedDate || 0);
                    case 'title':
                        return (a.title || '').localeCompare(b.title || '');
                    case 'category':
                        return (a.category || '').localeCompare(b.category || '');
                    default:
                        return 0;
                }
            });

            currentPage = 1;
            renderArticles();
            updateStats();
            updatePagination();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('tierFilter').value = '';
            document.getElementById('labelFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('sortBy').value = 'tier';
            
            filteredArticles = [...articles];
            currentPage = 1;
            renderArticles();
            updateStats();
            updatePagination();
        }

        // ============================================
        // RENDERING
        // ============================================
        function renderArticles() {
            const container = document.getElementById('articlesContainer');
            const startIdx = (currentPage - 1) * articlesPerPage;
            const pageArticles = filteredArticles.slice(startIdx, startIdx + articlesPerPage);
            const search = document.getElementById('searchInput').value.toLowerCase();

            if (pageArticles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <p>No articles match your filters</p>
                    </div>
                `;
                return;
            }

            if (currentView === 'grid') {
                container.innerHTML = `<div class="articles-grid">${pageArticles.map(a => renderArticleCard(a, search)).join('')}</div>`;
            } else {
                container.innerHTML = `<div class="articles-list">${pageArticles.map(a => renderArticleListItem(a, search)).join('')}</div>`;
            }

            document.getElementById('visibleCount').textContent = filteredArticles.length;
        }

        function renderArticleCard(article, search) {
            const tierClass = article.significanceTier === 'First-Tier' ? 'label-tier-first' : 'label-tier-second';
            let title = escapeHTML(article.title || 'No Title');
            let description = escapeHTML(article.description || '').substring(0, 200);
            
            if (search) {
                title = highlightSearch(title, search);
                description = highlightSearch(description, search);
            }

            const dateStr = article.publishedDate 
                ? new Date(article.publishedDate).toLocaleDateString() 
                : (article.collectedDate ? new Date(article.collectedDate).toLocaleDateString() : '--');

            const selectedClass = article.selected ? 'selected' : '';
            const featuredClass = article.featured ? 'featured' : '';

            return `
                <div class="article-card ${selectedClass} ${featuredClass}" data-index="${article._index}">
                    <input type="checkbox" class="article-checkbox" 
                           ${article.selected ? 'checked' : ''} 
                           onchange="toggleSelect(${article._index})">
                    <button class="article-star ${article.featured ? 'active' : ''}" 
                            onclick="toggleFeatured(${article._index})" 
                            title="Mark as featured">‚≠ê</button>
                    
                    <div class="article-card-header" style="padding-left: 30px;">
                        <div class="article-title">
                            ${article.url 
                                ? `<a href="${escapeHTML(article.url)}" target="_blank">${title}</a>` 
                                : title}
                        </div>
                        <span class="article-source">${escapeHTML(article.source || 'Unknown')}</span>
                    </div>
                    
                    <div class="article-description">${description}</div>
                    
                    <div class="article-labels">
                        <span class="label ${tierClass}">${article.significanceTier || 'Unranked'}</span>
                        <span class="label label-category">${escapeHTML(article.category || 'Uncategorized')}</span>
                        ${article.subsection ? `<span class="label label-subsection">${escapeHTML(article.subsection)}</span>` : ''}
                        ${(article.labels || []).map(l => `<span class="label">${escapeHTML(l)}</span>`).join('')}
                    </div>
                    
                    <div class="article-meta">
                        <span>üìÖ ${dateStr}</span>
                    </div>
                </div>
            `;
        }

        function renderArticleListItem(article, search) {
            const tierClass = article.significanceTier === 'First-Tier' ? 'label-tier-first' : 'label-tier-second';
            let title = escapeHTML(article.title || 'No Title');
            let description = escapeHTML(article.description || '').substring(0, 300);
            
            if (search) {
                title = highlightSearch(title, search);
                description = highlightSearch(description, search);
            }

            const dateStr = article.publishedDate 
                ? new Date(article.publishedDate).toLocaleDateString() 
                : (article.collectedDate ? new Date(article.collectedDate).toLocaleDateString() : '--');

            const selectedClass = article.selected ? 'selected' : '';

            return `
                <div class="article-list-item ${selectedClass}" data-index="${article._index}">
                    <input type="checkbox" class="article-list-checkbox" 
                           ${article.selected ? 'checked' : ''} 
                           onchange="toggleSelect(${article._index})">
                    
                    <div class="article-list-main">
                        <div class="article-title">
                            ${article.url 
                                ? `<a href="${escapeHTML(article.url)}" target="_blank">${title}</a>` 
                                : title}
                        </div>
                        <div class="article-description">${description}</div>
                        <div class="article-labels">
                            <span class="label ${tierClass}">${article.significanceTier || 'Unranked'}</span>
                            <span class="label label-category">${escapeHTML(article.category || 'Uncategorized')}</span>
                            ${article.subsection ? `<span class="label label-subsection">${escapeHTML(article.subsection)}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="article-list-sidebar">
                        <div class="article-source">${escapeHTML(article.source || 'Unknown')}</div>
                        <div style="margin: 8px 0; font-size: 0.85rem; color: #666;">üìÖ ${dateStr}</div>
                        <button class="btn btn-small ${article.featured ? 'btn-warning' : 'btn-secondary'}" 
                                onclick="toggleFeatured(${article._index})">
                            ${article.featured ? '‚≠ê Featured' : '‚òÜ Feature'}
                        </button>
                    </div>
                </div>
            `;
        }

        function toggleView() {
            const btn = document.getElementById('viewToggleBtn');
            if (currentView === 'grid') {
                currentView = 'list';
                btn.textContent = 'üìä Grid View';
            } else {
                currentView = 'grid';
                btn.textContent = 'üìã List View';
            }
            renderArticles();
        }

        // ============================================
        // SELECTION
        // ============================================
        function toggleSelect(index) {
            const article = articles.find(a => a._index === index);
            if (article) {
                article.selected = !article.selected;
                renderArticles();
                updateStats();
            }
        }

        function toggleFeatured(index) {
            const article = articles.find(a => a._index === index);
            if (article) {
                article.featured = !article.featured;
                if (article.featured && !article.selected) {
                    article.selected = true;
                }
                renderArticles();
                updateStats();
            }
        }

        function selectAllVisible() {
            filteredArticles.forEach(a => {
                const original = articles.find(x => x._index === a._index);
                if (original) original.selected = true;
            });
            renderArticles();
            updateStats();
            showToast(`Selected ${filteredArticles.length} articles`, 'success');
        }

        function clearSelection() {
            articles.forEach(a => {
                a.selected = false;
                a.featured = false;
            });
            renderArticles();
            updateStats();
            showToast('Selection cleared', 'success');
        }

        function updateStats() {
            const selected = articles.filter(a => a.selected);
            const featured = articles.filter(a => a.featured);
            const firstTier = articles.filter(a => a.significanceTier === 'First-Tier');

            document.getElementById('totalCount').textContent = articles.length;
            document.getElementById('firstTierCount').textContent = firstTier.length;
            document.getElementById('selectedCount').textContent = selected.length;
            document.getElementById('featuredCount').textContent = featured.length;
            document.getElementById('selectionDisplay').textContent = selected.length;
            document.getElementById('featuredDisplay').textContent = featured.length;

            document.getElementById('generateBtn').disabled = selected.length === 0;
        }

        // ============================================
        // PAGINATION
        // ============================================
        function updatePagination() {
            const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
        }

        function changePage(delta) {
            const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);
            const newPage = currentPage + delta;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderArticles();
                updatePagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ============================================
        // NEWSLETTER GENERATION
        // ============================================
        function generateNewsletter() {
            const selectedArticles = articles.filter(a => a.selected);
            const featuredArticles = articles.filter(a => a.featured);

            if (selectedArticles.length === 0) {
                showToast('Please select at least one article', 'error');
                return;
            }

            generatedHTML = buildNewsletterHTML(selectedArticles, featuredArticles);
            
            const modal = document.getElementById('previewModal');
            const iframe = document.getElementById('previewFrame');
            
            iframe.srcdoc = generatedHTML;
            modal.classList.add('active');
            
            showToast(`Newsletter generated with ${selectedArticles.length} articles`, 'success');
        }

        function buildNewsletterHTML(selectedArticles, featuredArticles) {
            const issueNum = metadata.issueNumber || '###';
            const today = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', month: 'long', day: 'numeric' 
            });

            // Group by category
            const grouped = {};
            selectedArticles.forEach(article => {
                const cat = article.category || 'Other';
                if (!grouped[cat]) grouped[cat] = [];
                grouped[cat].push(article);
            });

            let sectionsHTML = '';

            // Featured section
            if (featuredArticles.length > 0) {
                sectionsHTML += buildSection('Featured Articles', featuredArticles, true);
            }

            // Category sections
            const sectionOrder = [
                { key: 'Big Bet 1', title: 'Big Bet 1: Deliver Done-for-You Experiences' },
                { key: 'Big Bet 2', title: 'Big Bet 2: Accelerate Money Benefits', hasSubsections: true },
                { key: 'Big Bet 3', title: 'Big Bet 3: Fuel Mid-Market Success' },
                { key: 'Business Platform', title: 'Business Platform (Small Business)' },
                { key: 'Economic Indicators', title: 'Economic Indicators' },
                { key: 'AI Corner', title: 'AI Corner' },
                { key: 'FinTech Funding', title: 'FinTech Funding Updates' },
                { key: 'Intuit Internal', title: 'Intuit Internal / Announcements' }
            ];

            sectionOrder.forEach(section => {
                const sectionArticles = grouped[section.key];
                if (sectionArticles && sectionArticles.length > 0) {
                    const nonFeatured = sectionArticles.filter(a => !a.featured);
                    if (nonFeatured.length > 0) {
                        if (section.hasSubsections) {
                            sectionsHTML += buildSectionWithSubsections(section.title, nonFeatured);
                        } else {
                            sectionsHTML += buildSection(section.title, nonFeatured);
                        }
                    }
                }
            });

            // Handle remaining categories
            Object.keys(grouped).forEach(cat => {
                if (!sectionOrder.find(s => s.key === cat)) {
                    const nonFeatured = grouped[cat].filter(a => !a.featured);
                    if (nonFeatured.length > 0) {
                        sectionsHTML += buildSection(cat, nonFeatured);
                    }
                }
            });

            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }
        .wrapper { max-width: 800px; margin: 0 auto; background: white; }
        .header { background: linear-gradient(135deg, #0077C5 0%, #004D80 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { margin: 0 0 5px 0; font-size: 28px; letter-spacing: 2px; }
        .header h2 { margin: 0; font-size: 18px; font-weight: normal; opacity: 0.9; }
        .header .issue { font-size: 14px; margin-top: 15px; opacity: 0.85; }
        .content { padding: 30px; }
        .section { margin: 30px 0; }
        .section h2 { color: #0077C5; border-bottom: 3px solid #0077C5; padding-bottom: 10px; font-size: 20px; margin-bottom: 20px; }
        .section h3 { color: #004D80; margin: 25px 0 15px 0; font-size: 16px; border-left: 4px solid #0077C5; padding-left: 12px; }
        .article { margin: 20px 0; padding: 20px; background: #fafafa; border-left: 4px solid #0077C5; border-radius: 0 8px 8px 0; }
        .article.featured { border-left-color: #ffc107; background: #fffdf5; }
        .article-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .article-title a { color: #0077C5; text-decoration: none; }
        .article-title a:hover { text-decoration: underline; }
        .article-description { margin: 12px 0; font-size: 14px; color: #444; line-height: 1.7; }
        .article-relevance { margin-top: 12px; padding: 12px; background: #e8f4fc; border-radius: 6px; font-style: italic; font-size: 13px; color: #004D80; }
        .article-relevance::before { content: "üíº "; }
        .article-meta { font-size: 12px; color: #666; margin-top: 12px; display: flex; gap: 15px; flex-wrap: wrap; }
        .label { display: inline-block; background: #0077C5; color: white; padding: 3px 10px; border-radius: 4px; font-size: 11px; font-weight: 500; }
        .footer { text-align: center; padding: 25px; color: #666; font-size: 12px; border-top: 1px solid #e0e0e0; background: #fafafa; }
        @media print { body { background: white; } .wrapper { box-shadow: none; } }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="header">
            <h1>INTUIT</h1>
            <h2>Competitive Intelligence Newsletter</h2>
            <div class="issue">Issue ${issueNum} ¬∑ ${today}</div>
        </div>
        <div class="content">
            ${sectionsHTML}
        </div>
        <div class="footer">
            <p><strong>Intuit Confidential and Proprietary</strong></p>
            <p>Copyright ¬© ${new Date().getFullYear()} Intuit, All rights reserved.</p>
        </div>
    </div>
</body>
</html>
`;
        }

        function buildSection(title, articles, isFeatured = false) {
            return `
        <div class="section">
            <h2>${escapeHTML(title)}</h2>
            ${articles.map(a => buildArticleHTML(a, isFeatured)).join('')}
        </div>`;
        }

        function buildSectionWithSubsections(title, articles) {
            const subsections = {};
            const noSubsection = [];
            
            articles.forEach(a => {
                if (a.subsection) {
                    if (!subsections[a.subsection]) subsections[a.subsection] = [];
                    subsections[a.subsection].push(a);
                } else {
                    noSubsection.push(a);
                }
            });

            let html = `<div class="section"><h2>${escapeHTML(title)}</h2>`;

            if (noSubsection.length > 0) {
                html += noSubsection.map(a => buildArticleHTML(a)).join('');
            }

            const order = ['Consumers', 'Payments', 'Capital', 'Bill Pay'];
            order.forEach(sub => {
                if (subsections[sub]) {
                    html += `<h3>${escapeHTML(sub)}</h3>`;
                    html += subsections[sub].map(a => buildArticleHTML(a)).join('');
                }
            });

            Object.keys(subsections).forEach(sub => {
                if (!order.includes(sub)) {
                    html += `<h3>${escapeHTML(sub)}</h3>`;
                    html += subsections[sub].map(a => buildArticleHTML(a)).join('');
                }
            });

            html += '</div>';
            return html;
        }

        function buildArticleHTML(article, isFeatured = false) {
            const dateStr = article.publishedDate 
                ? new Date(article.publishedDate).toLocaleDateString() 
                : '';

            const featuredClass = (isFeatured || article.featured) ? 'featured' : '';

            return `
            <div class="article ${featuredClass}">
                <div class="article-title">
                    ${article.url 
                        ? `<a href="${escapeHTML(article.url)}" target="_blank">${escapeHTML(article.title)}</a>` 
                        : escapeHTML(article.title)}
                </div>
                <div class="article-description">${escapeHTML(article.description || '')}</div>
                ${article.companyRelevance ? `<div class="article-relevance">${escapeHTML(article.companyRelevance)}</div>` : ''}
                <div class="article-meta">
                    <span>üì∞ ${escapeHTML(article.source || 'Unknown')}</span>
                    ${dateStr ? `<span>üìÖ ${dateStr}</span>` : ''}
                    ${(article.labels || []).map(l => `<span class="label">${escapeHTML(l)}</span>`).join('')}
                </div>
            </div>`;
        }

        // ============================================
        // OUTPUT FUNCTIONS
        // ============================================
        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
        }

        function copyHTML() {
            navigator.clipboard.writeText(generatedHTML).then(() => {
                showToast('HTML copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy HTML', 'error');
            });
        }

        function downloadHTML() {
            const blob = new Blob([generatedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CI_Newsletter_${metadata.issueNumber || 'draft'}_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('HTML file downloaded!', 'success');
        }

        function downloadPDF() {
            const iframe = document.getElementById('previewFrame');
            iframe.contentWindow.focus();
            iframe.contentWindow.print();
            showToast('Use "Save as PDF" in the print dialog', 'success');
        }

        // ============================================
        // REFRESH DATA FROM BACKEND
        // ============================================
        async function refreshData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalText = refreshBtn.innerHTML;
            
            try {
                // Disable button and show loading state
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = '‚è≥ Refreshing...';
                
                showToast('Fetching latest data from Google Sheets...', 'info');
                
                // Call the backend refresh endpoint
                const response = await fetch('http://localhost:5000/refresh', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Update the article data
                    metadata = result.data.metadata;
                    articles = result.data.articles.map((a, i) => ({
                        ...a,
                        _index: i,
                        selected: a.selected || false,
                        featured: a.featured || false
                    }));
                    
                    filteredArticles = [...articles];
                    
                    // Refresh the UI
                    updateHeaderMeta();
                    populateFilterOptions();
                    applyFilters();
                    updateStats();
                    
                    showToast(`‚úÖ Refreshed! Loaded ${result.data.metadata.totalArticles} articles`, 'success');
                } else {
                    throw new Error(result.error || 'Unknown error occurred');
                }
            } catch (error) {
                console.error('Refresh error:', error);
                showToast(`‚ùå Refresh failed: ${error.message}`, 'error');
            } finally {
                // Re-enable button and restore text
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = originalText;
            }
        }

        // ============================================
        // UTILITIES
        // ============================================
        function escapeHTML(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&')
                .replace(/</g, '<')
                .replace(/>/g, '>')
                .replace(/"/g, '"')
                .replace(/'/g, ''');
        }

        function highlightSearch(text, search) {
            if (!search) return text;
            const regex = new RegExp(`(${search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (type !== 'info' ? ` ${type}` : '');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modal on overlay click
        document.getElementById('previewModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
